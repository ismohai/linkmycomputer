# MuMu 局域网远控设计方案

## 目标

实现一套局域网低延迟远控系统，让手机可以直接观看并操控 Windows 上的 MuMu 模拟器，支持真实多点触控。

## 背景

用户在电脑模拟器上玩手游时，键鼠映射上手成本高，常见远控工具延迟偏大，无法满足高频操作场景。

## 范围

- 手机端实时显示模拟器画面。
- 手机端发送多点触控事件到主机。
- 仅支持局域网连接，优先低延迟。
- 帧率档位支持 `60/90/120/144`。
- 分辨率档位支持到 `2460x1080`。

## 非目标

- 首版不做公网中继。
- 首版不做 iOS 客户端。
- 首版不做全模拟器通用适配（以 MuMu 优先）。

## 系统架构

### 桌面主机端（Windows）

- `client/host-core`：负责采集、编码、传输、触控注入、会话编排。
- `client`（Tauri + React）：负责参数配置、状态显示、启动/停止控制。

### 手机端（Android）

- Kotlin 原生实现触控采集与后续视频渲染链路。
- 维持完整 pointer 生命周期，保障多指一致性。

### 传输层

- 使用 WebRTC 承载视频与控制通道。
- 视频走媒体流，触控指令走 DataChannel。

## MuMu 输入方案

- 主路径采用 `ADB + minitouch`。
- 主机发现可用 MuMu 设备并转发触控指令。
- 协议携带 pointerId、动作、归一化坐标、压力值、时间戳。

## 性能策略

- 默认策略为 `Turbo Lock`（固定档位运行，不自动降档）。
- 启动前先做能力校验，不满足条件直接提示并拒绝启动。
- 不支持的档位返回可用候选档位。

## 关键数据流

1. 主机采集 MuMu 窗口帧。
2. 按配置档位进行编码。
3. 通过 WebRTC 下发视频流。
4. 手机端解码并显示。
5. 手机触控层上报多点事件。
6. 主机接收事件并转为 minitouch 指令注入 MuMu。

## 异常处理

- 设备发现失败：给出明确排查提示。
- ADB 断链：自动重试并在 UI 提示。
- 档位不可用：阻止启动并提示可用档位。
- 控制通道中断：冻结触控并尝试重连。

## 验证目标

- 手势正确性：双指缩放、三指点击、拖拽、长按。
- 稳定性：持续 15 分钟不掉线。
- 性能：通过能力校验后，帧率稳定在选定档位。
- 延迟观测：采集到显示、触控到注入全链路可观测。

## 交付阶段

- P0：端到端 PoC（单指）。
- P1：多点触控 + 档位切换。
- P2：120/144 高频档稳定性优化。
- P3：GitHub Actions 自动打包桌面端与安卓端。
